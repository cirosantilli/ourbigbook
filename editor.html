<!doctype html>
<html lang=en>
<head>
<meta charset=utf-8>
<title>Cirodown editor demo</title>
<link rel="stylesheet" href="cirodown.min.css">
<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background-color: black;
}
#container {
  align-items: center;
  display: flex;
  /* https://stackoverflow.com/questions/12989931/body-height-100-displaying-vertical-scrollbar/46847795#46847795
   * 20 == 2x 10px padding (top + bottom). */
  height: calc(100% - 20px);
  padding: 10px;
}
#input {
  border: 1px black solid;
  flex-grow: 1;
  height: 100%;
  margin: 0 5px 0 0;
  width: 50%;
}
#output {
  border: 1px black solid;
  flex-grow: 1;
  height: 100%;
  margin: 0 0 0 5px;
  overflow: auto;
  width: 50%;
}
</style>
</head>
<body>
<div id="container">
<div id="input"></div>
<div id="output" class="cirodown">
</div>
</div>
<script src="cirodown.js"></script>
<script>
// Otherwise the monaco-editor loader messes up with browserify and cirodown is not visible...
const my_cirodown = cirodown;
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/loader.min.js"></script>
<script>
const input_elem = document.getElementById('input');
const output_elem = document.getElementById('output');

require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs' }});
window.MonacoEnvironment = { getWorkerUrl: () => proxy };
const proxy = URL.createObjectURL(new Blob([`
    self.MonacoEnvironment = {
        baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min'
    };
    importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/base/worker/workerMain.min.js');
`], { type: 'text/javascript' }));
require(["vs/editor/editor.main"], function () {
    const editor = monaco.editor.create(
        input_elem,
        {
            minimap: {enabled: false},
            theme: 'vs-dark',
            value: `= Cirodown hello world

Welcome to Cirodown! Here's the table of contents:

\\Toc

== Paragraphs, code, math

My first paragraph is amazing!

And the second one with inline code \`f(){}\` and inline server-side rendered maths with KaTeX: $\\sqrt{1+1}$.

But if we want block code here it is:
\`\`
f() {
  return 1;
}
\`\`
and here is some block maths:
$$
\\sqrt{1+1} \\\\
\\sqrt{1+1}
$$

Ciro loves maths, and so equations can have titles, and references to math equations just work! See e.g.: \\x[my-favorite-equation]
$$
\\newcommand{\\va}[1]{\\overrightarrow{#1}}
\\newcommand{\\B}[0]{\\va{\\mathbf{B}}}
\\newcommand{\\E}[0]{\\va{\\mathbf{E}}}
\\newcommand{\\divergence}[1]{\\nabla \\cdot #1}
\\newcommand{\\vacuumPermittivity}[0]{\\varepsilon_0}
\\divergence{\\E} = \\frac{\\rho}{\\vacuumPermittivity} \\\\
\\divergence{\\B} = 0
$$
{title=This is my favorite equation in the entire world!!!}
{id=my-favorite-equation}

== Lists, tables, quotation

Meh, the usual. Insane list:
* first item
* second item
  * some nesting
  * and some more
* third item
Sane list with explicit \`Ul\`:
\\Ul[
\\L[first item]
\\L[second item]
]

And now for tables, see this one \\x[table-my-table].
\\Table
{title=My table title}
{id=table-my-table}
[
|| Header 1
|| Header 2

| 1 1
| 1 2

| 2 1
| 2 2
]

And a quotation:
\\Q[To be or not to be!

Cirodown is the answer.]

== References, headers, images

Ciro loves headers and headers!

Reference to a header: \\x[paragraphs-code-math]. Or if you want to show the section id: \\x[paragraphs-code-math]{style=full}.

Reference to the following image: \\x[image-my-xi-chrysanthemum].

\\Image[https://raw.githubusercontent.com/cirosantilli/media/master/Chrysanthemum_Xi_Jinping_with_black_red_liusi_added_by_Ciro_Santilli.jpg]
{title=Xi Chrysanthemum is a very nice image}
{id=image-my-xi-chrysanthemum}
{source=https://commons.wikimedia.org/wiki/File:Lotus_flower_(978659).jpg}

=== Unlimited header levels?!

==== My h4

===== My h5

====== My h6

\\H[7][My h7]

\\H[8][My h8]

\\H[9][My h9]

\\H[10][My h10]

\\H[11][My h11]

\\H[12][My h12]

\\H[13][My h13]
`,
        }
    );
    editor.onKeyUp(function (e) {
        convert_input()
    });
    function convert_input() {
        output_elem.innerHTML = my_cirodown.convert(
            editor.getValue(), {'body_only': true});
    }
    convert_input();
});
</script>
<!-- TODO this duplicates with code in ./cirodown but I'm lazy to solve it better right now -->
<script src="node_modules/tablesort/src/tablesort.js"></script>
<script src="node_modules/tablesort/src/sorts/tablesort.date.js"></script>
<script src="node_modules/tablesort/src/sorts/tablesort.dotsep.js"></script>
<script src="node_modules/tablesort/src/sorts/tablesort.filesize.js"></script>
<script src="node_modules/tablesort/src/sorts/tablesort.monthname.js"></script>
<script src="node_modules/tablesort/src/sorts/tablesort.number.js"></script>

<script src="cirodown.runtime.js"></script>
</body>
</html>
