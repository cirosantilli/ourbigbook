#!/usr/bin/env bash
# https://cirosantilli.com/cirodown#do-the-release
set -eux
if [ $# -lt 1 ]; then
  echo 'Missing version'
  exit 1
else
  version="$1"
fi
npm test
# To be able to add it to the NPM package for the template generation. I call bullshit!
# https://stackoverflow.com/questions/24976950/how-do-i-include-a-gitignore-file-as-part-of-my-npm-module
cp .gitignore gitignore
# This also does npm run build-assets
npm run publish
sed -i "s/  \"version\":.*/  \"version\": \"${version}\",/" package.json
# To update the package-lock.json.
# Not sure why needed twice, some mess with link madness.
npm run link
npm run link
git add -u
git commit -m "version $version"
git tag -m "$version" "$version"
git push --follow-tags
npm publish
./update-templates
