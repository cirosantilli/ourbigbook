<!doctype html>
<html lang=en>
<head>
<meta charset=utf-8>
<title>Wikipedia bot - OurBigBook Docs</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.1/css/all.min.css" integrity="sha512-9my9Mb2+0YO+I4PUCSwUYO7sEK21Y0STBAiFEYoWtd2VzLEZZ4QARDrZ30hdM1GlioHJ8o8cWQiy8IAb1hy/Hg==" crossorigin="anonymous" referrerpolicy="no-referrer">
<style>@import "_obb/dist/ourbigbook.css";

</style>
<link rel="stylesheet" type="text/css" href="_raw/main.css">
<link rel="shortcut icon" href="_raw/logo.svg">
</head>
<body>
<header
<div class="brand-group">
<a href="." class="brand"><img src="_raw/logo.svg" alt="OurBigBook logo">OurBigBook Docs</a>
<a href="https://ourbigbook.com" class="brand"><img src="_raw/logo.svg" alt="OurBigBook logo"><span class="mobile-hide">OurBigBook.com</span><span class="mobile-show">Site</span></a>
<a href="https://github.com/ourbigbook/ourbigbook"><i class="fab fa-github fa-fw icon"></i> Source code</a>
</div>
</header>
<main class="ourbigbook">
<div class="h top" id="wikipedia-bot"><div class="notnav"><h1><a href="">Wikipedia bot <span class="meta">(wikibot)</span></a></h1></div><nav class="h-nav h-nav-toplevel"><div class="nav ancestors"><a href="."><span title="Home" class="fa-solid-900 icon"></span> Home</a><a href=".#ourbigbook-web"> OurBigBook Web</a><a href=".#ourbigbook-web-development"> OurBigBook Web development</a><a href=".#generated-data"> Generated data</a></div><div class="nav"><a class="nosplit" href=".#wikipedia-bot"></a><span class="metrics"><span class="wcntr"> Words: 470</span></span></div></nav></div><div class="list"><ul id="_4115"><li id="_4116"><a href=".#ourbigbook-com">OurBigBook.com</a> user: <a href="https://ourbigbook.com/wikibot">ourbigbook.com/wikibot</a></li><li id="_4117"><a href=".#p-publish">Static website</a> render: <a href="https://wikibot.ourbigbook.com">wikibot.ourbigbook.com</a></li><li id="_4118"><a href=".#p-publish">Static website</a> source code: <a href="https://github.com/ourbigbook/wikibot">github.com/ourbigbook/wikibot</a></li></ul></div><div class="p" id="_4119">This bot imports the Wikipedia article category tree into OurBigBook. Only titles are currently imported, not the actual article content.</div><div class="p" id="_4120">This is just an exploratory step to future exports or generative AI.</div><div class="p" id="_4121">We don't have an amazing automation setup as we should, but the steps are:<div class="list"><ul id="_4122"><li id="_4123">obtain <code>enwiki.sqlite</code> containing the tables <code>page</code> and <code>categorylinks</code> <a href="https://stackoverflow.com/questions/17432254/wikipedia-category-hierarchy-from-dumps/77313490#77313490">stackoverflow.com/questions/17432254/wikipedia-category-hierarchy-from-dumps/77313490#77313490</a></li><li id="_4124">Run <a href="https://cirosantilli.com/_raw/wikipedia/sqlite_preorder.py">cirosantilli.com/_raw/wikipedia/sqlite_preorder.py</a>, potentially differently parametrized, as:<div class="code" id="_4125"><div><pre><code>rm -rf out
./sqlite_preorder.py -D3 -d6 -Obigb -m -N enwiki.sqlite Mathematics Physics Chemistry Biology Technology
cd out
ls . | grep -E '\.bigb$' | xargs sed -i -r '${/^$/d}'
echo '{}' &gt; ourbigbook.json
echo '*.tmp' &gt; .gitignore
ourbigbook .</code></pre></div></div>To publish as a <a href=".#p-publish">Static website</a> we do:<div class="code" id="_4126"><div><pre><code>  git init
  git add .
  export GIT_COMMITTER_EMAIL='bot@mail.com';
  export GIT_COMMITTER_NAME='Mr. Bot';
  export GIT_COMMITTER_DATE="2000-01-01T00:00:00+0000";
  export GIT_AUTHOR_EMAIL="$GIT_COMMITTER_EMAIL";
  export GIT_AUTHOR_NAME="$GIT_COMMITTER_NAME";
  export GIT_AUTHOR_DATE="$GIT_COMMITTER_DATE";
  git config --add user.email "$GIT_COMMITTER_EMAIL"
  git config --add user.name "$GIT_COMMITTER_NAME"
  git commit --author "${GIT_COMMITTER_NAME} &lt;${GIT_COMMITTER_EMAIL}&gt;" -m 'Autogenerated commit'
)</code></pre></div></div>and for <a href=".#ourbigbook-web">OurBigBook Web</a> it is important to use the <a href=".#web-nested-set-bulk"><code>--web-nested-set-bulk</code></a> option to speed thing up:<div class="code" id="_4127"><div><pre><code>ourbigbook --web --web-nested-set-bulk</code></pre></div></div>The current limiting factor on the number of articles per user is memory of the <a href=".#nested-set">nested set</a> generation. We've managed to review this and reduce it with attribute selection, but we have not yet been able to indefinitely scale it, e.g. we would not be able to handle 1M articles per user. The root problems are:<div class="list"><ul id="_4128"><li id="_4129">lack of depth first in SQLite due to lack of arrays, as opposed to PostgreSQL: <a href="https://stackoverflow.com/questions/65247873/preorder-tree-traversal-using-recursive-ctes-in-sql/77276675#77276675">stackoverflow.com/questions/65247873/preorder-tree-traversal-using-recursive-ctes-in-sql/77276675#77276675</a></li><li id="_4130">lack of proper streaming in Sequelize: <a href="https://stackoverflow.com/questions/28787889/how-can-i-set-up-sequelize-js-to-stream-data-instead-of-a-promise-callback">stackoverflow.com/questions/28787889/how-can-i-set-up-sequelize-js-to-stream-data-instead-of-a-promise-callback</a></li></ul></div></li></ul></div></div><div class="p" id="_4131">Now let's look at the shape of the data. Total pages:<div class="code" id="_4132"><div><pre><code>sqlite3 enwiki.sqlite 'select count(*) from page'</code></pre></div></div>gives ~59M.</div><div class="p" id="_4133">Total articles:<div class="code" id="_4134"><div><pre><code>sqlite3 enwiki.sqlite 'select count(*) from page where page_namespace = 0'</code></pre></div></div>gives ~17M.</div><div class="p" id="_4135">Total non-redirect articles:<div class="code" id="_4136"><div><pre><code>sqlite3 enwiki.sqlite 'select count(*) from page where page_namespace = 0 page_is_redirect = 0'</code></pre></div></div>gives: ~6.7M</div><div class="p" id="_4137">Categories:<div class="code" id="_4138"><div><pre><code>sqlite3 enwiki.sqlite 'select count(*) from page where page_namespace = 14'</code></pre></div></div>gives: ~2.3M.</div><div class="p" id="_4139">Allowing for depth 6 of all of STEM:<div class="code" id="_4140"><div><pre><code>./sqlite_preorder.py -D3 -d6 -Obigb -m -N enwiki.sqlite Mathematics Physics Chemistry Biology Technology</code></pre></div></div>leads to ~980k articles.</div><div class="p" id="_4141">Depth 6 on Mathematics only:<div class="code" id="_4142"><div><pre><code>./sqlite_preorder.py -D3 -d6 -Obigb -m -N enwiki.sqlite Mathematics</code></pre></div></div>leads to 150k articles. Some useless hogs and how they were reached:<div class="list"><ul id="_4143"><li id="_4144">Actuarial science via Applied Mathematis: 4k</li><li id="_4145">Molecular biology via Applied geometry: 4k</li><li id="_4146">Ship identification numbers via Numbers: 5k</li><li id="_4147">Galaxies via Dynamical systems: 7k</li><li id="_4148">Video game gameplay via Game design via Game theory: 17k</li></ul></div></div><div class="p" id="_4149">Depth 6 on Mathematics + Physics:<div class="code" id="_4150"><div><pre><code>./sqlite_preorder.py -D3 -d5 -Obigb -m -N enwiki.sqlite Mathematics Physics</code></pre></div></div>leads to 104k articles.</div><div class="p" id="_4151">Allowing for unlimited depth on Mathematics:<div class="code" id="_4152"><div><pre><code>./sqlite_preorder.py -D3 -Obigb -m -N enwiki.sqlite Mathematics</code></pre></div></div>leads seems to reach all ~9M articles + categories , or most of them. We gave up around 8.6M, when things got really really slow, possibly due to heavy duplicate removal. We didn't log it properly, but depths of 3k+ were seen... so not setting depth is just pointless unless you want the entire Wiki.</div><h2 id="_ancestors"><a href="#_ancestors"><span class="fa-solid-900 icon"></span> Ancestors <span class="meta">(4)</span></a></h2><div class="list"><ol><li><a href=".#generated-data">Generated data</a></li><li><a href=".#ourbigbook-web-development">OurBigBook Web development</a></li><li><a href=".#ourbigbook-web">OurBigBook Web</a></li><li><a href="."><span title="Home" class="fa-solid-900 icon"></span> Home</a></li></ol></div><h2 id="_incoming-links"><a href="#_incoming-links"><span title="Incoming links" class="fa-solid-900 icon"></span> Incoming links <span class="meta">(3)</span></a></h2><div class="list"><ul><li><a href=".#ourbigbook-web-performance-log">OurBigBook Web performance log</a></li><li><a href=".#parallel-build">Parallel build</a></li><li><a href=".#web-nested-set-bulk"><code>--web-nested-set-bulk</code></a></li></ul></div></main>
<footer>
<div>License: <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> unless noted</div>
<div><a href="_dir">Website source code</a></div>
<div>Source code for this page: <a href="_file/index.bigb">index.bigb</a></div>
</footer>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2XSEK2ND00"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2XSEK2ND00');
</script>
<script src="https://giscus.app/client.js"
        data-repo="ourbigbook/ourbigbook"
        data-repo-id="MDEwOlJlcG9zaXRvcnkyMTEyOTA2NzA="
        data-category="giscus"
        data-category-id="DIC_kwDODJgKLs4CZ61S"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="dark_high_contrast"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
<script>
window.ourbigbook_split_headers = true;
window.ourbigbook_html_x_extension = false;
window.ourbigbook_redirect_prefix = "";
</script>
<script src="_obb/dist/ourbigbook_runtime.js"></script><script>ourbigbook_runtime.ourbigbook_runtime()</script></body>
</html>
